import{q as s,w as c,e as t,o as u,f as d,g as a,s as f,h as l,i as h,k as m,m as w,l as g}from"./index-DhwsGjdY.js";async function D(r){let o=null;try{o=(await d(t,r)).id}catch(e){return e.message}finally{return o}}async function v(r){var o=null;try{const e=a(t,r);o=await h(e)}catch(e){o=e.message}finally{return o}}async function y(r){try{var o=[];if(!r)throw new Error("user is undefined");if((await l(s(t,c("user","==",r)))).forEach(n=>{o.push(n)}),o.length===0)throw new Error("User not found");return o[0]}catch(e){return e}}async function T(r,o){try{const e=await y(r);if(e&&e.id){const n=a(t,e.id);await f(n,o)}else console.error("Document not found for user:",r)}catch(e){return console.error("Error in setDocument:",e),e}}function q(r){const o=s(t);return u(o,e=>{const n=[];e.forEach(i=>{n.push({...i.data(),docId:i.id})}),r(n)})}function N(r,o){if(!r)return()=>{};const e=s(t,c("user","==",r));return u(e,n=>{n.empty?o(null):o(n.docs[0].data())},n=>{console.error("Subscription error:",n)})}const E=async r=>{try{if(await Notification.requestPermission()==="granted"){const e=await m(w,{vapidKey:"BBhWNZ1gSMzdcK2Tr4OhE2wu6m9YtlHVoZ72xsxHFVmDRQEOheC_nXvBKIhPEsW1UHZ2FL9j5GNr57g8VTrgNqw"});if(e)return console.log("FCM Token Alındı:",e),await p(r,e),e}}catch(o){console.log("Token alma hatası:",o)}return null},p=async(r,o)=>{if(r)try{const e=a(g,"tokens",r);await f(e,{token:o,updatedAt:new Date},{merge:!0})}catch(e){console.error("Token kaydetme hatası:",e)}},R=async(r,o)=>{if(Notification.permission==="granted")try{if("serviceWorker"in navigator){const e=await navigator.serviceWorker.ready;if(e&&"showNotification"in e){await e.showNotification(r,{body:o,icon:"/favicon.ico"});return}}new Notification(r,{body:o,icon:"/favicon.ico"})}catch(e){console.warn("Bildirim hatası (Önemsiz):",e)}};export{N as a,T as b,q as c,v as d,D as i,E as r,R as s};

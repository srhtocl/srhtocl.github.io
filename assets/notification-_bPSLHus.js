import{q as u,o as d,f as g,g as a,w as f,h as c,s as i,i as h,k as w,l as y,m as D,n as l}from"./index-CVH5nPcp.js";const s=(o,r=null,e=null)=>({success:o,data:r,error:e?{code:e.code||"UNKNOWN",message:e.message||"An error occurred"}:null});async function k(o){try{const r=await g(a,o);return s(!0,{id:r.id})}catch(r){return console.error("Service Error (insertDocument):",r),s(!1,null,r)}}async function N(o){try{const r=c(a,o);return await w(r),s(!0)}catch(r){return console.error("Service Error (deleteDocument):",r),s(!1,null,r)}}async function m(o){try{if(!o)throw new Error("Username parameter is required");const r=u(a,f("user","==",o)),e=await h(r),t=[];return e.forEach(n=>t.push({...n.data(),id:n.id})),t.length===0?s(!1,null,{code:"NOT_FOUND",message:"User not found"}):s(!0,t[0])}catch(r){return console.error("Service Error (getDocumentsByUsername):",r),s(!1,null,r)}}async function E(o,r){try{const e=await m(o);if(!e.success&&e.error?.code==="NOT_FOUND")return s(!1,null,{code:"NOT_FOUND",message:"Target document for user not found"});if(!e.success)return e;const t=e.data,n=c(a,t.id);return await i(n,r,{merge:!0}),s(!0)}catch(e){return console.error("Service Error (setDocument):",e),s(!1,null,e)}}function U(o){const r=u(a);return d(r,e=>{const t=[];e.forEach(n=>{t.push({...n.data(),docId:n.id})}),o(t)},e=>{console.error("Subscription Error (All):",e)})}function q(o,r){if(!o)return()=>{};const e=u(a,f("user","==",o));return d(e,t=>{t.empty?r(null):(r({success:!0,...t.docs[0].data()}),r(t.docs[0].data()))},t=>{console.error("Subscription Error (User):",t)})}const b=async o=>{if(!("Notification"in window))return console.log("This browser does not support desktop notification"),null;try{if(await Notification.requestPermission()==="granted"){const e=await y(D,{vapidKey:"BBhWNZ1gSMzdcK2Tr4OhE2wu6m9YtlHVoZ72xsxHFVmDRQEOheC_nXvBKIhPEsW1UHZ2FL9j5GNr57g8VTrgNqw"});if(e)return console.log("FCM Token Alındı:",e),await p(o,e),e}}catch(r){console.log("Token alma hatası:",r)}return null},p=async(o,r)=>{if(o)try{if(o==="admin_device"){const e=c(l,"admin","notifications");await i(e,{token:r,updatedAt:new Date},{merge:!0})}else{const e=await m(o);if(e.success&&e.data){const t=e.data.id,n=c(l,"chats",t);await i(n,{fcmToken:r,tokenUpdatedAt:new Date},{merge:!0})}else console.warn("Token kaydedilemedi: Kullanıcı dökümanı bulunamadı.",o)}}catch(e){console.error("Token kaydetme hatası:",e)}};export{E as a,U as b,N as d,k as i,b as r,q as s};

import{r as n,u as g,a as v,j as e,L as N}from"./index-C5HVSTo6.js";import{b as y,r as m,d as w}from"./notification-BAUpJzIH.js";import{h as z,j as k,g as M}from"./index-C1ZMg-5I.js";import{z as o}from"./index-WMgs0FGb.js";function D(){const[r,d]=n.useState([]),[x,b]=n.useState(typeof Notification<"u"?Notification.permission:"default"),l=g(),c=v(),u=n.useRef(0),f=n.useRef(!0);n.useEffect(()=>{if(!r)return;const t=r.reduce((s,i)=>s+(i.messages?i.messages.length:0),0);if(f.current){r.length>0&&(u.current=t,f.current=!1);return}u.current=t},[r]),n.useEffect(()=>{if(!l.user){c("/");return}const t=y(s=>{d(s)});return typeof Notification<"u"&&Notification.permission==="granted"&&m("admin_device"),()=>t()},[l.user,c]);const h=async()=>{if(typeof Notification>"u"){o.error("Tarayıcınız bildirimleri desteklemiyor.");return}const t=await m("admin_device");b(Notification.permission),t&&console.log("Admin bildirimleri açıldı.")},p=async(t,s)=>{if(t.preventDefault(),t.stopPropagation(),window.confirm("Bu mesajı silmek istediğinize emin misiniz?")){const i=await w(s);i.success?(o.success("Mesaj silindi."),d(a=>a.filter(j=>j.docId!==s))):(o.error("Silme işlemi başarısız!"),console.error(i.error))}};return e.jsxs("div",{className:"relative flex flex-col w-full h-[100dvh] overflow-hidden bg-slate-50",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[60vw] h-[60vw] bg-slate-200 rounded-full mix-blend-multiply filter blur-[80px] opacity-20 animate-blob pointer-events-none"}),e.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[60vw] h-[60vw] bg-blue-100 rounded-full mix-blend-multiply filter blur-[80px] opacity-20 animate-blob animation-delay-2000 pointer-events-none"}),x!=="granted"&&e.jsx("div",{className:"absolute top-4 right-4 z-50",children:e.jsxs("button",{onClick:h,className:"flex items-center gap-2 bg-white/80 backdrop-blur-md shadow-lg border border-slate-200 px-3 py-2 rounded-full text-slate-600 text-sm hover:bg-white hover:text-blue-600 transition-all animate-pulse",title:"Bildirimleri Aç",children:[e.jsx(z,{size:16}),e.jsx("span",{children:"Bildirimleri Aç"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-6 z-10 space-y-3 pt-24 pb-24",children:l.user?r.length>0?r.map(t=>{if(!t.messages||!t.messages[0])return null;const s=t.messages.at(-1),i=s.user==="admin";return e.jsxs(N,{to:`/response/${t.user}`,className:"group block bg-white/80 backdrop-blur-md border border-slate-100/50 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-all active:scale-98",children:[e.jsxs("div",{className:"bg-slate-50/80 px-4 py-2 flex justify-between items-center border-b border-slate-100/50",children:[e.jsx("h3",{className:"text-slate-800 font-bold font-['Ubuntu'] text-sm truncate",children:t.user}),e.jsx("button",{onClick:a=>p(a,t.docId),className:"w-8 h-8 flex items-center justify-center text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-full transition-all shrink-0",title:"Mesajı Sil",children:e.jsx(k,{size:16})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("p",{className:"text-slate-600 text-sm truncate font-['Ubuntu'] leading-relaxed",children:[i&&e.jsx("span",{className:"font-medium text-slate-800",children:"Siz: "}),s.data]})}),s.time&&e.jsx("div",{className:"bg-slate-50/50 px-4 py-2 border-t border-slate-100/50 flex justify-end",children:e.jsx("span",{className:"text-[10px] text-slate-400 font-['Ubuntu']",children:new Date(s.time).toLocaleDateString("tr-TR",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"})})})]},t.docId||t.user)}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400 font-['Ubuntu'] gap-4 mt-20",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center",children:e.jsx(M,{size:32})}),e.jsx("p",{children:"Henüz mesaj yok."})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-red-400",children:e.jsx("p",{children:"Yetkisiz Erişim"})})})]})}export{D as default};

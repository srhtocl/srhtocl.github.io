import{q as c,o as i,f,g as a,w as l,h as u,s as d,i as m,k as g,l as h,m as y,n as D}from"./index-CwJ2VU-d.js";const t=(s,e=null,r=null)=>({success:s,data:e,error:r?{code:r.code||"UNKNOWN",message:r.message||"An error occurred"}:null});async function N(s){try{const e=await f(a,s);return t(!0,{id:e.id})}catch(e){return console.error("Service Error (insertDocument):",e),t(!1,null,e)}}async function E(s){try{const e=u(a,s);return await m(e),t(!0)}catch(e){return console.error("Service Error (deleteDocument):",e),t(!1,null,e)}}async function w(s){try{if(!s)throw new Error("Username parameter is required");const e=c(a,l("user","==",s)),r=await g(e),o=[];return r.forEach(n=>o.push({...n.data(),id:n.id})),o.length===0?t(!1,null,{code:"NOT_FOUND",message:"User not found"}):t(!0,o[0])}catch(e){return console.error("Service Error (getDocumentsByUsername):",e),t(!1,null,e)}}async function k(s,e){try{const r=await w(s);if(!r.success&&r.error?.code==="NOT_FOUND")return t(!1,null,{code:"NOT_FOUND",message:"Target document for user not found"});if(!r.success)return r;const o=r.data,n=u(a,o.id);return await d(n,e),t(!0)}catch(r){return console.error("Service Error (setDocument):",r),t(!1,null,r)}}function q(s){const e=c(a);return i(e,r=>{const o=[];r.forEach(n=>{o.push({...n.data(),docId:n.id})}),s(o)},r=>{console.error("Subscription Error (All):",r)})}function U(s,e){if(!s)return()=>{};const r=c(a,l("user","==",s));return i(r,o=>{o.empty?e(null):(e({success:!0,...o.docs[0].data()}),e(o.docs[0].data()))},o=>{console.error("Subscription Error (User):",o)})}const O=async s=>{try{if(await Notification.requestPermission()==="granted"){const r=await h(y,{vapidKey:"BBhWNZ1gSMzdcK2Tr4OhE2wu6m9YtlHVoZ72xsxHFVmDRQEOheC_nXvBKIhPEsW1UHZ2FL9j5GNr57g8VTrgNqw"});if(r)return console.log("FCM Token Al覺nd覺:",r),await T(s,r),r}}catch(e){console.log("Token alma hatas覺:",e)}return null},T=async(s,e)=>{if(s)try{const r=u(D,"tokens",s);await d(r,{token:e,updatedAt:new Date},{merge:!0})}catch(r){console.error("Token kaydetme hatas覺:",r)}};export{k as a,q as b,E as d,N as i,O as r,U as s};

import{r as o,u as U,a as D,b as L,j as e,x as S,y as _,z,A as E}from"./index-CaIjCW_9.js";import{u as F,i as I}from"./post-methods-o_lmt7Km.js";import{j as b,m as A,i as $}from"./index-CLdYaTTE.js";const G=()=>{const[n,m]=o.useState(""),[i,c]=o.useState([]),[l,g]=o.useState([]),[d,f]=o.useState(!1),u=o.useRef(null),v=U(),x=D(),a=L().state?.postToEdit;o.useEffect(()=>{v.user||x("/"),a&&(m(a.content),a.images&&Array.isArray(a.images)?c(a.images):a.image_url&&c([a.image_url]))},[a]);const j=()=>{u.current.click()},w=t=>{if(t.target.files){const s=Array.from(t.target.files);g(r=>[...r,...s])}},N=t=>{g(s=>s.filter((r,h)=>h!==t)),u.current&&(u.current.value="")},y=t=>{c(s=>s.filter(r=>r!==t))},k=async()=>{if(!n.trim()&&i.length===0&&l.length===0||!n.trim())return;f(!0);let t=[...i];try{if(l.length>0){const r=l.map(async p=>{const C=S(_,`posts/${Date.now()}_${p.name}`),R=await z(C,p);return E(R.ref)}),h=await Promise.all(r);t=[...t,...h]}const s={content:n,images:t,image_url:t.length>0?t[0]:null,updated_at:new Date};a?await F(a.id,s):(s.timestamp=new Date,await I(s)),m(""),g([]),c([]),x("/posts")}catch(s){console.error("Post save error:",s),alert("Gönderi paylaşılırken bir hata oluştu: "+s.message)}finally{f(!1)}};return e.jsxs("div",{className:"relative flex flex-col w-full h-[100dvh] overflow-hidden bg-slate-50 items-center pt-24",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[60vw] h-[60vw] bg-slate-200 rounded-full mix-blend-multiply filter blur-[80px] opacity-20 pointer-events-none"}),e.jsx("div",{className:"relative z-20 w-full max-w-lg px-4",children:e.jsxs("div",{className:"bg-white border border-slate-200 rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-100/50 px-4 py-3 flex items-center gap-3 border-b border-slate-100",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-200 overflow-hidden",children:e.jsx("img",{src:"https://pbs.twimg.com/profile_images/1483105275766882304/4CYpr2hO_400x400.jpg",alt:"Profile",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-slate-700 font-bold text-sm font-['Ubuntu']",children:"Serhat Öcal"}),e.jsx("span",{className:"text-slate-400 text-xs",children:new Date().toLocaleDateString("tr-TR")})]})]}),e.jsxs("div",{className:"p-4 bg-slate-50/30",children:[e.jsx("textarea",{placeholder:"Ne düşünüyorsun?",className:"w-full h-32 bg-transparent border-none text-slate-700 placeholder-slate-400 outline-none resize-none font-['Ubuntu'] text-lg",value:n,onChange:t=>m(t.target.value),disabled:d}),(i.length>0||l.length>0)&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 overflow-x-auto h-[56px] py-1 px-1 scrollbar-hide",children:[i.map((t,s)=>e.jsxs("div",{className:"relative flex-shrink-0 w-10 h-10 rounded-md overflow-hidden group border border-slate-200",children:[e.jsx("img",{src:t,alt:"existing",className:"w-full h-full object-cover"}),e.jsx("button",{onClick:()=>y(t),className:"absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white",children:e.jsx(b,{size:14})})]},`existing-${s}`)),l.map((t,s)=>e.jsxs("div",{className:"relative flex-shrink-0 w-10 h-10 rounded-md overflow-hidden group border border-blue-200 ring-1 ring-blue-100",children:[e.jsx("img",{src:URL.createObjectURL(t),alt:"preview",className:"w-full h-full object-cover",onLoad:r=>URL.revokeObjectURL(r.target.src)}),e.jsx("button",{onClick:()=>N(s),className:"absolute inset-0 bg-blue-500/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white",children:e.jsx(b,{size:14})})]},`new-${s}`))]}),e.jsx("input",{type:"file",ref:u,onChange:w,accept:"image/*",multiple:!0,className:"hidden"})]}),e.jsxs("div",{className:"bg-slate-100/50 px-4 py-3 flex justify-between items-center border-t border-slate-100",children:[e.jsx("button",{onClick:j,className:`transition-colors p-2 rounded-full hover:bg-slate-200/50 ${l.length>0||i.length>0?"text-blue-600 bg-blue-50":"text-slate-400 hover:text-slate-600"}`,title:"Resim Ekle",disabled:d,children:e.jsx(A,{size:24})}),e.jsx("button",{onClick:k,disabled:!n.trim()&&i.length===0&&l.length===0||d,className:`transform transition-all duration-200 ${n.trim()||i.length>0||l.length>0?"text-blue-600 hover:scale-110":"text-slate-300"}`,children:e.jsx($,{size:24,className:d?"animate-pulse":""})})]})]})})]})};export{G as default};

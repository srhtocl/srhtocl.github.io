import{j as p,r as d}from"./index-DhgEgQ22.js";import{i as b,r as w,s as M,a as k}from"./notification-BH-iEjth.js";import{z as g}from"./index-BBB4lfJl.js";function E(e){return p.jsx("div",{className:"flex flex-col w-full p-4 space-y-4",children:e.messages[0]?e.messages.map((s,r)=>p.jsx("div",{id:r,className:`flex w-full ${s.user==="admin"?"justify-end":"justify-start"}`,children:p.jsx("div",{className:`max-w-[75%] px-5 py-3 rounded-2xl shadow-sm text-sm md:text-base font-['Ubuntu'] ${s.user==="admin"?"bg-slate-700 text-white rounded-tr-none":"bg-white text-slate-800 border border-slate-200 rounded-tl-none"}`,children:s.data})},r)):p.jsx("div",{className:"flex flex-col items-center justify-center h-full text-slate-500 opacity-70",children:p.jsx("div",{className:"bg-white/50 p-6 rounded-2xl shadow-sm text-center max-w-xs backdrop-blur-sm",children:p.jsx("p",{className:"font-['Ubuntu'] text-sm",children:"Merhaba! Mesajlar anonim olarak iletilir ve tarama geçmişi temizlendiğinde silinir."})})})})}function x(e){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var t in r)e[t]=r[t]}return e}var z={read:function(e){return e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function j(e,s){function r(i,u,n){if(!(typeof document>"u")){n=x({},s,n),typeof n.expires=="number"&&(n.expires=new Date(Date.now()+n.expires*864e5)),n.expires&&(n.expires=n.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var c in n)n[c]&&(a+="; "+c,n[c]!==!0&&(a+="="+n[c].split(";")[0]));return document.cookie=i+"="+e.write(u,i)+a}}function t(i){if(!(typeof document>"u"||arguments.length&&!i)){for(var u=document.cookie?document.cookie.split("; "):[],n={},a=0;a<u.length;a++){var c=u[a].split("="),h=c.slice(1).join("=");try{var m=decodeURIComponent(c[0]);if(n[m]=e.read(h,m),i===m)break}catch{}}return i?n[i]:n}}return Object.create({set:r,get:t,remove:function(i,u){r(i,"",x({},u,{expires:-1}))},withAttributes:function(i){return j(this.converter,x({},this.attributes,i))},withConverter:function(i){return j(x({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(s)},converter:{value:Object.freeze(e)}})}var y=j(z,{path:"/"});const T=(e=null)=>{const[s,r]=d.useState([]),[t,i]=d.useState(e),[u,n]=d.useState(!0),[a,c]=d.useState(!1),[h,m]=d.useState(typeof Notification<"u"?Notification.permission:"default"),N=d.useRef(!1);return d.useEffect(()=>{let l=null;return(async()=>{let o=t;if(!e){if(o=y.get("user"),o)y.set("user",o,{expires:7});else{o=new Date().getTime().toString(16),y.set("user",o,{expires:7});const f=await b({user:o,messages:[]});f.success||(g.error("Bağlantı hatası: Kullanıcı oluşturulamadı."),console.error(f.error))}typeof Notification<"u"&&Notification.permission==="granted"&&w(o)}i(o),l=M(o,f=>{f&&f.messages&&r(f.messages),n(!1),N.current=!0})})(),()=>{l&&l()}},[e]),{user:t,messages:s,loading:u,sending:a,sendMessage:async(l,v=!1)=>{if(!l.trim()||a||!t)return;c(!0);const o={user:v?"admin":t,time:new Date().getTime(),data:l.trim()},f=[...s,o];r(f);const C=await k(t,{user:t,messages:f});C.success?!v&&!e&&typeof Notification<"u"&&Notification.permission!=="granted"&&(await w(t),m(Notification.permission)):(g.error("Mesaj gönderilemedi! Lütfen internet bağlantınızı kontrol edin."),console.error("Send Error:",C.error)),c(!1)},notificationPermission:h,enableNotifications:async()=>{if(!t)return;if(typeof Notification>"u"){g.error("Tarayıcınız bildirimleri desteklemiyor.");return}const l=await w(e||t);return m(Notification.permission),l&&g.success("Bildirimler açıldı!"),l}}};export{E as M,T as u};

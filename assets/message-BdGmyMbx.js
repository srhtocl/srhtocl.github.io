import{r as l,j as i}from"./index-DhwsGjdY.js";import{M as k}from"./message-field-ChYpnGUE.js";import{s as D,i as U,r as w,a as z,b as B}from"./notification-oS3uJoJ2.js";import{h as M,i as R}from"./index-utr88vKs.js";function g(s){for(var c=1;c<arguments.length;c++){var n=arguments[c];for(var f in n)s[f]=n[f]}return s}var E={read:function(s){return s[0]==='"'&&(s=s.slice(1,-1)),s.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(s){return encodeURIComponent(s).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function j(s,c){function n(e,d,t){if(!(typeof document>"u")){t=g({},c,t),typeof t.expires=="number"&&(t.expires=new Date(Date.now()+t.expires*864e5)),t.expires&&(t.expires=t.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var u="";for(var o in t)t[o]&&(u+="; "+o,t[o]!==!0&&(u+="="+t[o].split(";")[0]));return document.cookie=e+"="+s.write(d,e)+u}}function f(e){if(!(typeof document>"u"||arguments.length&&!e)){for(var d=document.cookie?document.cookie.split("; "):[],t={},u=0;u<d.length;u++){var o=d[u].split("="),p=o.slice(1).join("=");try{var m=decodeURIComponent(o[0]);if(t[m]=s.read(p,m),e===m)break}catch{}}return e?t[e]:t}}return Object.create({set:n,get:f,remove:function(e,d){n(e,"",g({},d,{expires:-1}))},withAttributes:function(e){return j(this.converter,g({},this.attributes,e))},withConverter:function(e){return j(g({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(c)},converter:{value:Object.freeze(s)}})}var v=j(E,{path:"/"});function O(){const[s,c]=l.useState(""),[n,f]=l.useState([]),[e,d]=l.useState(null),[t,u]=l.useState(!0),[o,p]=l.useState(!1),[m,x]=l.useState(Notification.permission),h=l.useRef(0),y=l.useRef(!1);l.useEffect(()=>{if(!t){if(!y.current){h.current=n.length,y.current=!0;return}if(n.length>h.current){const r=n[n.length-1];r.user==="admin"&&D("Yeni Cevap Var!",r.data),h.current=n.length}}},[n,t]),l.useEffect(()=>{let r=null;return(async()=>{let a=v.get("user");a?v.set("user",a,{expires:7}):(a=new Date().getTime().toString(16),v.set("user",a,{expires:7}),await U({user:a,messages:[]})),d(a),Notification.permission==="granted"&&w(a),r=z(a,b=>{b&&b.messages&&f(b.messages),u(!1)})})(),()=>{r&&r()}},[]);const C=async()=>{if(!e)return;const r=await w(e);x(Notification.permission),r&&console.log("Bildirimler başarıyla açıldı.")},S=async r=>{if(r.preventDefault(),!s.trim()||o)return;p(!0);const N={user:e,time:new Date().getTime(),data:s.trim()},a=[...n,N];f(a),c("");try{await B(e,{user:e,messages:a})}finally{p(!1)}Notification.permission!=="granted"&&(await w(e),x(Notification.permission))};return i.jsxs("div",{className:"fixed inset-0 flex flex-col w-full h-full overflow-hidden bg-slate-50 overscroll-none",children:[i.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[50vw] h-[50vw] bg-slate-300 rounded-full mix-blend-multiply filter blur-[60px] opacity-20 animate-blob pointer-events-none"}),i.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[50vw] h-[50vw] bg-gray-300 rounded-full mix-blend-multiply filter blur-[60px] opacity-20 animate-blob animation-delay-2000 pointer-events-none"}),m!=="granted"&&!t&&i.jsx("div",{className:"absolute top-4 right-4 z-50",children:i.jsxs("button",{onClick:C,className:"flex items-center gap-2 bg-white/80 backdrop-blur-md shadow-lg border border-slate-200 px-3 py-2 rounded-full text-slate-600 text-sm hover:bg-white hover:text-blue-600 transition-all animate-pulse",title:"Bildirimleri Aç",children:[i.jsx(M,{size:16}),i.jsx("span",{children:"Bildirimleri Aç"})]})}),i.jsx("div",{className:"flex-1 overflow-y-auto z-10 w-full max-w-2xl mx-auto px-4 custom-scrollbar pb-4 pt-16",children:t?i.jsx("div",{className:"flex items-center justify-center h-full",children:i.jsx("div",{className:"w-8 h-8 border-4 border-slate-200 border-t-slate-800 rounded-full animate-spin"})}):i.jsx(k,{messages:n})}),i.jsx("div",{className:"flex-none z-20 w-full max-w-2xl mx-auto p-4 bg-slate-50/50 backdrop-blur-md border-t border-white/50",children:i.jsxs("form",{className:"flex items-center gap-2 bg-white rounded-2xl shadow-lg border border-slate-200 p-2 transition-all focus-within:ring-2 focus-within:ring-slate-300/50",onSubmit:S,children:[i.jsx("input",{className:"flex-auto bg-transparent border-none outline-none px-4 py-3 text-slate-700 placeholder-slate-400 font-['Ubuntu'] min-w-0",type:"text",value:s,placeholder:"Bir mesaj bırak...",onChange:r=>c(r.target.value)}),i.jsx("button",{type:"submit",disabled:!s.trim()||o,className:"flex-none flex items-center justify-center w-12 h-12 bg-slate-900 text-white rounded-xl hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-md active:scale-95",children:o?i.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):i.jsx(R,{size:20,className:s.trim()?"translate-x-0.5":""})})]})})]})}export{O as default};

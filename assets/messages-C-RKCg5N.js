import{r as a,u as p,a as j,j as e,L as g}from"./index-DhwsGjdY.js";import{s as v,c as N,r as m,d as w}from"./notification-oS3uJoJ2.js";import{h as y,j as k,g as z}from"./index-utr88vKs.js";function S(){const[i,c]=a.useState([]),[f,x]=a.useState(Notification.permission),r=p(),d=j(),l=a.useRef(0),u=a.useRef(!0);a.useEffect(()=>{if(!i)return;const t=i.reduce((s,n)=>s+(n.messages?n.messages.length:0),0);if(u.current){i.length>0&&(l.current=t,u.current=!1);return}t>l.current&&v("Anonim Mesaj!","Yeni bir mesaj aldınız."),l.current=t},[i]),a.useEffect(()=>{if(!r.user){d("/");return}const t=N(s=>{c(s)});return Notification.permission==="granted"&&m("admin_device"),()=>t()},[r.user,d]);const h=async()=>{const t=await m("admin_device");x(Notification.permission),t&&console.log("Admin bildirimleri açıldı.")},b=async(t,s)=>{t.preventDefault(),t.stopPropagation(),window.confirm("Bu mesajı silmek istediğinize emin misiniz?")&&(await w(s),c(n=>n.filter(o=>o.docId!==s)))};return e.jsxs("div",{className:"relative flex flex-col w-full h-[100dvh] overflow-hidden bg-slate-50",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[60vw] h-[60vw] bg-slate-200 rounded-full mix-blend-multiply filter blur-[80px] opacity-20 animate-blob pointer-events-none"}),e.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[60vw] h-[60vw] bg-blue-100 rounded-full mix-blend-multiply filter blur-[80px] opacity-20 animate-blob animation-delay-2000 pointer-events-none"}),f!=="granted"&&e.jsx("div",{className:"absolute top-4 right-4 z-50",children:e.jsxs("button",{onClick:h,className:"flex items-center gap-2 bg-white/80 backdrop-blur-md shadow-lg border border-slate-200 px-3 py-2 rounded-full text-slate-600 text-sm hover:bg-white hover:text-blue-600 transition-all animate-pulse",title:"Bildirimleri Aç",children:[e.jsx(y,{size:16}),e.jsx("span",{children:"Bildirimleri Aç"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 py-6 z-10 space-y-3 pt-24 pb-24",children:r.user?i.length>0?i.map(t=>{if(!t.messages||!t.messages[0])return null;const s=t.messages.at(-1),n=s.user==="admin";return e.jsxs(g,{to:`/response/${t.user}`,className:"group block bg-white/80 backdrop-blur-md border border-slate-100/50 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-all active:scale-98",children:[e.jsxs("div",{className:"bg-slate-50/80 px-4 py-2 flex justify-between items-center border-b border-slate-100/50",children:[e.jsx("h3",{className:"text-slate-800 font-bold font-['Ubuntu'] text-sm truncate",children:t.user}),e.jsx("button",{onClick:o=>b(o,t.docId),className:"w-8 h-8 flex items-center justify-center text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-full transition-all shrink-0",title:"Mesajı Sil",children:e.jsx(k,{size:16})})]}),e.jsx("div",{className:"p-4",children:e.jsxs("p",{className:"text-slate-600 text-sm truncate font-['Ubuntu'] leading-relaxed",children:[n&&e.jsx("span",{className:"font-medium text-slate-800",children:"Siz: "}),s.data]})}),s.time&&e.jsx("div",{className:"bg-slate-50/50 px-4 py-2 border-t border-slate-100/50 flex justify-end",children:e.jsx("span",{className:"text-[10px] text-slate-400 font-['Ubuntu']",children:new Date(s.time).toLocaleDateString("tr-TR",{day:"numeric",month:"long",hour:"2-digit",minute:"2-digit"})})})]},t.docId||t.user)}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400 font-['Ubuntu'] gap-4 mt-20",children:[e.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center",children:e.jsx(z,{size:32})}),e.jsx("p",{children:"Henüz mesaj yok."})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-red-400",children:e.jsx("p",{children:"Yetkisiz Erişim"})})})]})}export{S as default};

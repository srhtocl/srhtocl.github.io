import{u as R,a as U,r as s,d as w,e as y,g as P,x as k,y as L,z as D,A as S,C as j,D as C,s as E,j as e}from"./index-DwcND9pF.js";import{b as z,q as v}from"./index-CCbgk3eJ.js";import{i as N}from"./post-methods-DtH6erlw.js";import{n as b}from"./index-CuqCMT8r.js";const A=()=>{const{user:o}=R(),r=U(),[i,n]=s.useState({photoURL:"",bio:"",initialBio:""}),[g,m]=s.useState(!1),[h,f]=s.useState(!0);return s.useEffect(()=>{if(!o){r("/");return}(async()=>{f(!0);try{const a=w(y,"admin","profile"),t=await P(a);if(t.exists()){const l=t.data();n({photoURL:l.photoURL||"",bio:l.bio||"",initialBio:l.bio||""})}else n({photoURL:o.photoURL||"",bio:"",initialBio:""})}catch(a){console.error("[useProfile] Profil yükleme hatası:",a),b.error("Profil bilgileri yüklenemedi.")}finally{f(!1)}})()},[o,r]),{profile:i,loading:g,fetching:h,updateProfileData:async(c,a)=>{m(!0);try{let t=i.photoURL;if(c){const u=k(L,`profile/admin_profile_${Date.now()}`),x=await D(u,c);t=await S(x.ref)}j.currentUser&&await C(j.currentUser,{photoURL:t});const l=w(y,"admin","profile");return await E(l,{bio:a,photoURL:t,updatedAt:new Date},{merge:!0}),c?await N({content:a,images:[t],image_url:t,timestamp:new Date}):a!==i.initialBio&&await N({content:`Durum güncellemesi: 

"${a}" ✍️`,images:[],image_url:null,timestamp:new Date}),n(u=>({...u,photoURL:t,bio:a,initialBio:a})),b.success("Profil başarıyla güncellendi!"),!0}catch(t){return console.error("[useProfile] Güncelleme hatası:",t),b.error("Hata: "+t.message),!1}finally{m(!1)}}}},K=()=>{const{user:o}=R(),r=U(),{profile:i,loading:n,fetching:g,updateProfileData:m}=A(),[h,f]=s.useState(""),[p,c]=s.useState(null);s.useEffect(()=>{i&&f(i.bio)},[i]);const a=s.useRef(null);s.useEffect(()=>{o||r("/")},[o,r]);const t=d=>{d.target.files&&d.target.files[0]&&c(d.target.files[0])},l=()=>{a.current.click()},u=async()=>{await m(p,h)&&setTimeout(()=>r(0),1e3)},x=p?URL.createObjectURL(p):i.photoURL||null;return g?e.jsx("div",{className:"flex justify-center pt-20 h-full bg-slate-50",children:e.jsx("div",{className:"w-8 h-8 border-4 border-slate-200 border-t-slate-800 rounded-full animate-spin"})}):e.jsxs("div",{className:"w-full h-full flex flex-col font-['Ubuntu'] bg-slate-50 overflow-y-auto",children:[e.jsx("div",{className:"flex-1 w-full max-w-2xl mx-auto p-6 space-y-8",children:e.jsxs("div",{className:"space-y-8 pt-8 flex flex-col items-center",children:[e.jsxs("div",{className:"relative group cursor-pointer",onClick:l,children:[e.jsxs("div",{className:"w-32 h-32 rounded-full ring-4 ring-white shadow-lg overflow-hidden relative bg-slate-200 flex items-center justify-center",children:[x?e.jsx("img",{src:x,alt:"Profile",className:"w-full h-full object-cover"}):e.jsx(z,{className:"text-slate-400 text-5xl"}),e.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(v,{className:"text-white text-3xl drop-shadow-md"})})]}),e.jsx("div",{className:"absolute bottom-0 right-0 bg-slate-900 text-white p-2 rounded-full shadow-md border-2 border-white hover:bg-blue-600 transition-colors",children:e.jsx(v,{size:16})}),e.jsx("input",{type:"file",ref:a,onChange:t,accept:"image/*",className:"hidden"})]}),e.jsxs("div",{className:"w-full space-y-3",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-500 uppercase tracking-wider block text-center",children:"Biyografi / Söz"}),e.jsx("div",{className:"relative",children:e.jsx("textarea",{value:h,onChange:d=>f(d.target.value),placeholder:"Bir-iki kelime bile sessizlikten iyidir...",className:"w-full bg-white border border-slate-200 rounded-xl py-4 px-4 text-slate-800 outline-none focus:border-slate-800 focus:ring-1 focus:ring-slate-800 transition-all font-medium placeholder:text-slate-300 shadow-sm min-h-[120px] resize-y font-['Marck_Script'] text-xl text-center"})})]})]})}),e.jsx("div",{className:"p-6 bg-transparent sticky bottom-0 z-10 flex justify-end",children:e.jsx("button",{onClick:u,disabled:n,className:"w-full md:w-auto px-8 py-4 bg-slate-900 text-white rounded-xl font-bold tracking-wide shadow-xl shadow-slate-900/10 active:scale-[0.98] transition-all disabled:opacity-70 disabled:cursor-not-allowed",children:n?"Kaydediliyor...":"KAYDET"})})]})};export{K as default};
